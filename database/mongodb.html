<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MongoDB分片介绍 | quiterr的个人博客</title>
    <meta name="description" content="quiterr的个人博客">
    <link rel="icon" href="/assets/img/logo.png">
    
    <link rel="preload" href="/assets/css/0.styles.2fd3a0e5.css" as="style"><link rel="preload" href="/assets/js/app.d45e7d8d.js" as="script"><link rel="preload" href="/assets/js/3.f201c9f2.js" as="script"><link rel="preload" href="/assets/js/2.58f2d4b3.js" as="script"><link rel="preload" href="/assets/js/9.05f51b5b.js" as="script"><link rel="prefetch" href="/assets/js/10.8f6ff41b.js"><link rel="prefetch" href="/assets/js/11.d3060e6c.js"><link rel="prefetch" href="/assets/js/12.5d5dd355.js"><link rel="prefetch" href="/assets/js/13.b58b39cd.js"><link rel="prefetch" href="/assets/js/14.132da01d.js"><link rel="prefetch" href="/assets/js/15.4de3abff.js"><link rel="prefetch" href="/assets/js/16.5d01f151.js"><link rel="prefetch" href="/assets/js/17.743cc240.js"><link rel="prefetch" href="/assets/js/18.5cd47213.js"><link rel="prefetch" href="/assets/js/19.c31513f4.js"><link rel="prefetch" href="/assets/js/20.ff0c8b17.js"><link rel="prefetch" href="/assets/js/21.23bfd343.js"><link rel="prefetch" href="/assets/js/22.7b1bcdc8.js"><link rel="prefetch" href="/assets/js/23.9aa9bcc6.js"><link rel="prefetch" href="/assets/js/24.41feae7a.js"><link rel="prefetch" href="/assets/js/25.085c0a62.js"><link rel="prefetch" href="/assets/js/26.28112f5e.js"><link rel="prefetch" href="/assets/js/27.3dfa1162.js"><link rel="prefetch" href="/assets/js/28.64b59646.js"><link rel="prefetch" href="/assets/js/29.5da0daa7.js"><link rel="prefetch" href="/assets/js/30.e061c642.js"><link rel="prefetch" href="/assets/js/31.af9d5f01.js"><link rel="prefetch" href="/assets/js/32.3bb3cd16.js"><link rel="prefetch" href="/assets/js/33.28c6384b.js"><link rel="prefetch" href="/assets/js/34.e24d72db.js"><link rel="prefetch" href="/assets/js/35.066a2949.js"><link rel="prefetch" href="/assets/js/36.3605469b.js"><link rel="prefetch" href="/assets/js/37.0f0334ec.js"><link rel="prefetch" href="/assets/js/38.c4e1f427.js"><link rel="prefetch" href="/assets/js/39.bf835b74.js"><link rel="prefetch" href="/assets/js/4.130bd99d.js"><link rel="prefetch" href="/assets/js/40.df4753ea.js"><link rel="prefetch" href="/assets/js/41.c0060482.js"><link rel="prefetch" href="/assets/js/42.13e0dffa.js"><link rel="prefetch" href="/assets/js/43.2a7ba197.js"><link rel="prefetch" href="/assets/js/44.4a50ce9b.js"><link rel="prefetch" href="/assets/js/45.04e3bb01.js"><link rel="prefetch" href="/assets/js/46.f860615e.js"><link rel="prefetch" href="/assets/js/47.57f7e152.js"><link rel="prefetch" href="/assets/js/48.c9adb86a.js"><link rel="prefetch" href="/assets/js/49.89d283b4.js"><link rel="prefetch" href="/assets/js/5.bc8341b3.js"><link rel="prefetch" href="/assets/js/50.176d29a8.js"><link rel="prefetch" href="/assets/js/51.73ee13f6.js"><link rel="prefetch" href="/assets/js/6.5dc22b3f.js"><link rel="prefetch" href="/assets/js/7.5d9116e6.js"><link rel="prefetch" href="/assets/js/8.ab4e4f3e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.2fd3a0e5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/img/logo.png" alt="quiterr的个人博客" class="logo"> <span class="site-name can-hide">quiterr的个人博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://www.jianshu.com/u/e268fe04200a" target="_blank" rel="noopener noreferrer" class="nav-link external">
  简书
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/quiterr" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.hanclouds.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  hanclouds
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://www.jianshu.com/u/e268fe04200a" target="_blank" rel="noopener noreferrer" class="nav-link external">
  简书
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/quiterr" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.hanclouds.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  hanclouds
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/architecture/" class="sidebar-heading clickable"><span>架构设计</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/source/" class="sidebar-heading clickable"><span>源码阅读</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/design-pattern/" class="sidebar-heading clickable"><span>设计模式</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/frontend/" class="sidebar-heading clickable"><span>前端开发</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/database/" class="sidebar-heading clickable router-link-active open"><span>数据库</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/database/" class="sidebar-link">《Elasticsearch权威指南》随笔</a></li><li><a href="/database/mongodb.html" class="active sidebar-link">MongoDB分片介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/database/mongodb.html#分片的目的" class="sidebar-link">分片的目的</a></li><li class="sidebar-sub-header"><a href="/database/mongodb.html#shard-cluster" class="sidebar-link">shard cluster</a></li><li class="sidebar-sub-header"><a href="/database/mongodb.html#片键" class="sidebar-link">片键</a></li><li class="sidebar-sub-header"><a href="/database/mongodb.html#分片策略" class="sidebar-link">分片策略</a></li><li class="sidebar-sub-header"><a href="/database/mongodb.html#chunks和均衡器（balancer）" class="sidebar-link">Chunks和均衡器（balancer）</a></li></ul></li><li><a href="/database/redis.html" class="sidebar-link">一致性hash和redis集群</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/collection/" class="sidebar-heading clickable"><span>资料收藏</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="mongodb分片介绍"><a href="#mongodb分片介绍" class="header-anchor">#</a> MongoDB分片介绍</h1> <h2 id="分片的目的"><a href="#分片的目的" class="header-anchor">#</a> 分片的目的</h2> <p>复制集（ replica set）可以备份数据，只能扩展读，在《高性能MySQL》第三版10.5节、《MongoDB权威指南》第二版11.4节 以及MongoDB官网<a href="https://docs.mongodb.com/v3.6/core/read-preference/" target="_blank" rel="noopener noreferrer">https://docs.mongodb.com/v3.6/core/read-preference/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>  都不推荐用复制集来扩展读（也就是常见的读写分离）。</p> <p><img src="/assets/img/read-preference.7532239d.png" alt="read-preference"></p> <p>为了<strong>同时扩展读、写的性能和存储的容量</strong>，达到水平扩容（<em>Horizontal Scaling</em> ）的目的，需要进行分片。</p> <h2 id="shard-cluster"><a href="#shard-cluster" class="header-anchor">#</a> shard cluster</h2> <ul><li>每一个分片（shard）包含集群的一部分数据，生产环境的每个分片要求部署为复制集</li> <li>mongos是查询路由，可以部署多个</li> <li>配置服务器（Config Servers）存储了集群的元数据和配置信息，必须是一个复制集</li></ul> <p><img src="/assets/img/sharded-cluster-production-architecture.e9713588.png" alt="sharded-cluster-production-architecture"></p> <h2 id="片键"><a href="#片键" class="header-anchor">#</a> 片键</h2> <p>在分片的集群中，数据的读写是按照片键来划分的。在MongoDB中，分片一旦开始，则不能更改片键。一个分片集群只能有一个片键。对非空的集合，分片前先要创建索引。空集合分片的索引由MongoDB自动创建。</p> <p><strong>片键的选择尤为重要，直接影响集群的性能、可扩展性。</strong></p> <p>片键的选择可以考虑基数（cardinality）、频率（frequency）和变化的情况（rate of change）。</p> <h3 id="基数（cardinality）"><a href="#基数（cardinality）" class="header-anchor">#</a> 基数（cardinality）</h3> <p>基数（cardinality）指的是片键所有可能的取值，分片集群中最小的存储单位是chunk，每个chunk在增大到一定级别后就会拆分，但是当一个chunk只有一个片键值的时候则不会拆分，因此基数决定了集群中chunk的最大数量。如果基数较小，chunk无法拆分就会形成很大的chunk，导致集群不均衡、迁移困难。如果一个字段作片键的基数较小，一般可以通过联合索引作片键来增大基数。</p> <h3 id="频率（frequency）"><a href="#频率（frequency）" class="header-anchor">#</a> 频率（frequency）</h3> <p>频率（frequency）指的是片键在集群中的分布情况，如果大部分数据的片键都相同，就说明片键的分布很集中，那么存储他们的 chunk 会成为数据库的一个瓶颈 ，这些chunk无法拆分，这时要考虑用联合索引。片键最好选择低频的字段（或多个字段）。</p> <h3 id="变化的情况（rate-of-change）"><a href="#变化的情况（rate-of-change）" class="header-anchor">#</a> 变化的情况（rate of change）</h3> <p>变化的情况（rate of change）在官网其实主要指是否单调递增或单调递减。单调变化的片键会导致所有的写入都在一个分片上，比如用递增的timestamp来做片键。下图是一个示例，X作为片键递增，新的数据都会写入到Chunk C。<img src="/assets/img/monotonic-distribution.7cefbf65.png" alt="sharded-cluster-monotonic-distribution"></p> <p>如果想用单调变化的字段来做片键，建议使用hash分片策略。</p> <h2 id="分片策略"><a href="#分片策略" class="header-anchor">#</a> 分片策略</h2> <p>MongoDB有hash分片和range分片两种分片策略。</p> <h3 id="hash分片"><a href="#hash分片" class="header-anchor">#</a> hash分片</h3> <p>hash分片就是对选取的字段先做hash计算再作为片键使用。可以让数据在各个shard上存储得更加均匀，特别是针对单调变化的片键。但是缺点是范围查询时，会进行广播操作（broadcast operations），也就是要到多个shard上去查询，最后由mongos汇总结果。广播操作的性能取决于最慢的那个shard，并且给多个shard造成了查询压力，最后还加重了mongos的负载，相当于集群读的能力并没有得到扩展。</p> <h3 id="range分片"><a href="#range分片" class="header-anchor">#</a> range分片</h3> <p>range分片把数据按照片键取值的范围来进行切分，例如0-20岁的数据放到chunk1，21-40岁的放到chunk2，41-60岁的放到chunk 3。range分片对查询比较好，如果要查15岁的人数据，mongos会知道去chunk1里查，不用进行广播查询。</p> <h2 id="chunks和均衡器（balancer）"><a href="#chunks和均衡器（balancer）" class="header-anchor">#</a> Chunks和均衡器（balancer）</h2> <h3 id="chunk"><a href="#chunk" class="header-anchor">#</a> chunk</h3> <p>MongoDB管理的最小存储单位是chunk，每个chunk包含了一个范围内片键的数据，这个范围左包右闭：[x,y)，最小就是一个片键值。MongoDB默认chunk最大是64M，超过这个值就会拆分成两个chunk，chunk的最大值可以通过命令修改。修改chunk的大小要考虑诸多因素：</p> <ul><li>小的chunk可以让集群的存储更加均匀，但是查询的时候可能更慢。</li> <li>大的chunk可以减少chunk的迁移，但有可能使集群的存储不是很均匀。</li> <li>chunk的大小还会影响到迁移，如果一个chunk的文档数量大于了1.3倍的（配置的chunk size /  平均每个文档的size），则MongoDB不会迁移该chunk。</li> <li>当对已存在数据的集合做分片时，chunk的大小还会影响最大集合size，见下图</li></ul> <p><img src="/assets/img/max-collection-size.ec6cb8f8.png" alt="max-collection-size"></p> <ul><li>减小chunk的大小后，并不会马上开始拆分，只有当有数据插入或更新时才会拆分。</li> <li>增大chunk的大小后，也不会合并，而是随着数据插入逐步增大。</li></ul> <h3 id="均衡器（balancer）"><a href="#均衡器（balancer）" class="header-anchor">#</a> 均衡器（balancer）</h3> <p>均衡器是一个运行在Config Server上的后台进程，时刻监控着每个shard上的chunk数量，当达到threshold值时，均衡器尝试迁移chunk，直到每个shard上的chunk数目相同。</p> <p><img src="data:image/png;base64,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" alt="threshold"></p> <p>chunk的迁移会增加网络带宽和系统负载，因此均衡器采取了一些机制来限制影响</p> <ul><li>每个shard一次只能参与一个chunk的迁移，对于拥有n个shard的集群来说，最多同时对n/2个chunk进行迁移。</li> <li>均衡器可以关闭，也可以指定均衡器在特定的时间窗口才进行chunk迁移。</li></ul> <h3 id="chunk迁移的过程"><a href="#chunk迁移的过程" class="header-anchor">#</a> chunk迁移的过程</h3> <ul><li>均衡器发送moveChunk命令到源shard。</li> <li>源shard开始迁移，迁移过程中的操作请求仍然发到源shard，包括对chunk的写入。</li> <li>目的shard创建相关的索引</li> <li>目的shard接收数据</li> <li>目的shard接收完数据之后，发起一个同步，使迁移过程中的变化都能同步过来</li> <li>当同步完成之后，源shard连接到config数据库，更新chunk的新位置信息到集群元数据</li> <li>更新元数据完毕之后，如果此时没有open状态的cursor，源shard会删除该chunk</li></ul> <p>在最后一步删除chunk操作之前，如果该shard上还有别的chunk要迁移，这时可以进行，不必等删除操作完成，这个机制官方称为<a href="https://docs.mongodb.com/v3.6/core/sharding-balancer-administration/#chunk-migration-queuing" target="_blank" rel="noopener noreferrer">Asynchronous Chunk Migration Cleanup<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">1/14/2020, 2:00:10 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/database/" class="prev router-link-active">
        《Elasticsearch权威指南》随笔
      </a></span> <span class="next"><a href="/database/redis.html">
        一致性hash和redis集群
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.d45e7d8d.js" defer></script><script src="/assets/js/3.f201c9f2.js" defer></script><script src="/assets/js/2.58f2d4b3.js" defer></script><script src="/assets/js/9.05f51b5b.js" defer></script>
  </body>
</html>
